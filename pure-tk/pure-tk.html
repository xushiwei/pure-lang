<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
<title>pure-tk</title>
<meta name="author" content="Albert Graef &lt;Dr.Graef&#64;t-online.de&gt;" />
<meta name="date" content="2010-03-26" />
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 5631 2008-08-24 13:01:23Z goodger $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left {
  clear: left }

img.align-right {
  clear: right }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="pure-tk">
<h1 class="title">pure-tk</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Author:</th>
<td>Albert Graef &lt;<a class="reference external" href="mailto:Dr.Graef&#64;t-online.de">Dr.Graef&#64;t-online.de</a>&gt;</td></tr>
<tr><th class="docinfo-name">Date:</th>
<td>2010-03-26</td></tr>
</tbody>
</table>
<p>Pure's <a class="reference external" href="http://www.tcl.tk">Tcl/Tk</a> interface.</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="auto-toc simple">
<li><a class="reference internal" href="#introduction" id="id1">1&nbsp;&nbsp;&nbsp;Introduction</a></li>
<li><a class="reference internal" href="#copying" id="id2">2&nbsp;&nbsp;&nbsp;Copying</a></li>
<li><a class="reference internal" href="#installation" id="id3">3&nbsp;&nbsp;&nbsp;Installation</a></li>
<li><a class="reference internal" href="#basic-usage" id="id4">4&nbsp;&nbsp;&nbsp;Basic Usage</a></li>
<li><a class="reference internal" href="#callbacks" id="id5">5&nbsp;&nbsp;&nbsp;Callbacks</a></li>
<li><a class="reference internal" href="#the-main-loop" id="id6">6&nbsp;&nbsp;&nbsp;The Main Loop</a></li>
<li><a class="reference internal" href="#accessing-tcl-variables" id="id7">7&nbsp;&nbsp;&nbsp;Accessing Tcl Variables</a></li>
<li><a class="reference internal" href="#tips-and-tricks" id="id8">8&nbsp;&nbsp;&nbsp;Tips and Tricks</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h1><a class="toc-backref" href="#id1">1&nbsp;&nbsp;&nbsp;Introduction</a></h1>
<p>This module provides a basic interface between Pure and Tcl/Tk. The operations
of this module allow you to execute arbitrary commands in the Tcl interpreter,
set and retrieve variable values in the interpreter, and invoke Pure callbacks
from Tcl/Tk.</p>
<p>A recent version of Tcl/Tk is required (8.0 or later should do). You can get
this from <a class="reference external" href="http://www.tcl.tk">http://www.tcl.tk</a>. Both releases in source form and binary releases
for Windows and various Unix systems are provided there.</p>
<p>Some information on how to use this module can be found below. But you'll find
that pure-tk is very easy to use, so you might just want to look at the
examples in the examples folder to pick it up at a glance. A very basic
example can be found in tk_hello.pure; a slightly more advanced example of a
tiny but complete Tk application is in tk_examp.pure.</p>
</div>
<div class="section" id="copying">
<h1><a class="toc-backref" href="#id2">2&nbsp;&nbsp;&nbsp;Copying</a></h1>
<p>Copyright (c) 2010 by Albert Gr√§f, all rights reserved. pure-tk is distributed
under a BSD-style license, see the COPYING file for details.</p>
</div>
<div class="section" id="installation">
<h1><a class="toc-backref" href="#id3">3&nbsp;&nbsp;&nbsp;Installation</a></h1>
<p>As with the other addon modules for Pure, running <tt class="docutils literal"><span class="pre">make</span> <span class="pre">&amp;&amp;</span> <span class="pre">sudo</span> <span class="pre">make</span>
<span class="pre">install</span></tt> should usually do the trick. This requires that you have Pure and
Tcl/Tk installed. <tt class="docutils literal"><span class="pre">make</span></tt> tries to guess your Pure installation directory and
platform-specific setup. If it gets this wrong, you can set some variables
manually. In particular, <tt class="docutils literal"><span class="pre">make</span> <span class="pre">install</span> <span class="pre">prefix=/usr</span></tt> sets the installation
prefix. Please see the Makefile for details.</p>
<p><strong>IMPORTANT:</strong> When starting a new interpreter, the Tcl/Tk initialization code
looks for some initialization files which it executes before anything else
happens. Usually these files will be found without any further ado, but if
that does not happen automatically, you must set the TCL_LIBRARY and
TK_LIBRARY environment variables to point to the Tcl and Tk library
directories on your system.</p>
</div>
<div class="section" id="basic-usage">
<h1><a class="toc-backref" href="#id4">4&nbsp;&nbsp;&nbsp;Basic Usage</a></h1>
<p>You can submit a command to the Tcl interpreter with <tt class="docutils literal"><span class="pre">tk</span> <span class="pre">cmd</span></tt> where <tt class="docutils literal"><span class="pre">cmd</span></tt>
is a string containing the command to be executed. This also starts a new
instance of the Tcl interpreter if it is not already running. To stop the Tcl
interpreter, you can use the <tt class="docutils literal"><span class="pre">tk_quit</span></tt> function. Note that, as far as
pure-tk is concerned, there's only one Tcl interpreter per process, but of
course you can create additional interpreter instances using the appropriate
Tcl commands.</p>
<p>Simple dialogs can be created directly using Tk's <tt class="docutils literal"><span class="pre">tk_messageBox</span></tt> and
<tt class="docutils literal"><span class="pre">tk_dialog</span></tt> functions. For instance:</p>
<pre class="literal-block">
tk &quot;tk_dialog .warning \&quot;Warning\&quot; \&quot;Are you sure?\&quot; warning 0 Yes No Cancel&quot;;
</pre>
<p>Other kinds of common dialogs are available; see the Tcl/Tk manual for
information.</p>
<p>For more elaborate applications you probably have to explicitly create some
widgets with the appropriate callbacks, and provide a main loop which takes
care of processing events in the Tcl/Tk GUI. We discuss this in the following.</p>
</div>
<div class="section" id="callbacks">
<h1><a class="toc-backref" href="#id5">5&nbsp;&nbsp;&nbsp;Callbacks</a></h1>
<p>pure-tk installs a special Tcl command named <tt class="docutils literal"><span class="pre">pure</span></tt> in the interpreter which
can be used to implement callbacks in Pure. This command is invoked from Tcl
as follows:</p>
<pre class="literal-block">
pure function args ...
</pre>
<p>It calls the Pure function named by the first argument. Any remaining
arguments are passed to the callback. Arguments looking like numeric literals
(int or double) are parsed and passed as numbers, everything else is passed as
a string. For instance:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">pure</span> <span class="pre">foo</span></tt></dt>
<dd>calls the Pure function <tt class="docutils literal"><span class="pre">foo</span></tt> without parameters;</dd>
<dt><tt class="docutils literal"><span class="pre">pure</span> <span class="pre">foo</span> <span class="pre">bar</span> <span class="pre">baz!?</span></tt></dt>
<dd>invokes <tt class="docutils literal"><span class="pre">foo</span></tt> as <tt class="docutils literal"><span class="pre">foo</span> <span class="pre">&quot;bar&quot;</span> <span class="pre">&quot;baz!?&quot;</span></tt>;</dd>
<dt><tt class="docutils literal"><span class="pre">pure</span> <span class="pre">foo</span> <span class="pre">1.0</span> <span class="pre">{Hello,</span> <span class="pre">world}</span></tt></dt>
<dd>invokes <tt class="docutils literal"><span class="pre">foo</span></tt> as <tt class="docutils literal"><span class="pre">foo</span> <span class="pre">1.0</span> <span class="pre">&quot;Hello,</span> <span class="pre">world&quot;</span></tt>.</dd>
</dl>
<p>Analogous conversions are applied to the result value, so if the callback
returns a string or a number (int or double) then this becomes the result of
the <tt class="docutils literal"><span class="pre">pure</span></tt> command in the Tcl interpreter. The callback can also return
multiple values as a tuple, which are converted to a corresponding Tcl
list. Other kinds of Pure values are silently ignored. For instance:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">foo</span> <span class="pre">=</span> <span class="pre">();</span></tt></dt>
<dd>returns nothing;</dd>
<dt><tt class="docutils literal"><span class="pre">foo</span> <span class="pre">=</span> <span class="pre">99;</span></tt></dt>
<dd>returns an integer <tt class="docutils literal"><span class="pre">99</span></tt>;</dd>
<dt><tt class="docutils literal"><span class="pre">foo</span> <span class="pre">=</span> <span class="pre">0.0,</span> <span class="pre">1.0,</span> <span class="pre">&quot;Hello,</span> <span class="pre">world&quot;;</span></tt></dt>
<dd>returns a Tcl list <tt class="docutils literal"><span class="pre">0.0</span> <span class="pre">1.0</span> <span class="pre">{Hello,</span> <span class="pre">world}</span></tt> consisting of two double
values and a string.</dd>
</dl>
</div>
<div class="section" id="the-main-loop">
<h1><a class="toc-backref" href="#id6">6&nbsp;&nbsp;&nbsp;The Main Loop</a></h1>
<p>The easiest way to provide a main loop for your application is to just call
<tt class="docutils literal"><span class="pre">tk_main</span></tt> which keeps processing events in the Tcl interpreter until the
interpreter is exited. You can terminate the interpreter in a Pure callback by
calling <tt class="docutils literal"><span class="pre">tk_quit</span></tt>. Thus a minimalistic Tcl/Tk application coded in Pure may
look as follows:</p>
<pre class="literal-block">
using tk;
tk &quot;button .b -text {Hello, world!} -command {pure tk_quit}; pack .b&quot;;
tk_main;
</pre>
<p>The main loop terminates as soon as the Tcl interpreter is exited, which can
happen, e.g., in response to a callback which invokes the <tt class="docutils literal"><span class="pre">tk_quit</span></tt> function
or Tcl code which destroys the main window (<tt class="docutils literal"><span class="pre">destroy</span> <span class="pre">.</span></tt>). The user can also
close the main window from the window manager in order to exit the main loop.</p>
</div>
<div class="section" id="accessing-tcl-variables">
<h1><a class="toc-backref" href="#id7">7&nbsp;&nbsp;&nbsp;Accessing Tcl Variables</a></h1>
<p>pure-tk also allows your script to set and retrieve variable values in the Tcl
interpreter with the <tt class="docutils literal"><span class="pre">tk_set</span></tt>, <tt class="docutils literal"><span class="pre">tk_unset</span></tt> and <tt class="docutils literal"><span class="pre">tk_get</span></tt> functions. This
is useful, e.g., to change the variables associated with entry and button
widgets, and to retrieve the current values from the application. For
instance:</p>
<pre class="literal-block">
&gt; tk_set &quot;entry_val&quot; &quot;some string&quot;;
&quot;some string&quot;
&gt; tk_get &quot;entry_val&quot;;
&quot;some string&quot;
&gt; tk_unset &quot;entry_val&quot;;
()
&gt; tk_get &quot;entry_val&quot;;
tk_get &quot;entry_val&quot;
</pre>
<p>Note that all values are passed as strings here. At the language level, this
is really the only data type that Tcl/Tk knows. (Internally, modern versions
of the Tcl interpreter use more elaborate representations of different kinds
of objects. However, to keep the interface simple, pure-tk doesn't provide
direct access to these, so you'll have to construct them using the appropriate
Tcl commands.)</p>
</div>
<div class="section" id="tips-and-tricks">
<h1><a class="toc-backref" href="#id8">8&nbsp;&nbsp;&nbsp;Tips and Tricks</a></h1>
<p>Here are a few other things that are useful when working with pure-tk.</p>
<ul>
<li><p class="first">Errors in Tcl/Tk commands can be handled by giving an appropriate definition
of the <tt class="docutils literal"><span class="pre">tk_error</span></tt> function, which is invoked with an error message as its
single argument. For instance, the following implementation of <tt class="docutils literal"><span class="pre">tk_error</span></tt>
throws an exception:</p>
<pre class="literal-block">
tk_error msg = throw msg;
</pre>
<p>If no definition for this function is provided, then errors cause a literal
<tt class="docutils literal"><span class="pre">tk_error</span> <span class="pre">msg</span></tt> expression to be returned as the result of the <tt class="docutils literal"><span class="pre">tk</span></tt>
function. You can then check for such results and take an appropriate
action.</p>
</li>
<li><p class="first">The Tcl interpreter, when started, displays a default main window, which is
required by most Tk applications. If this is not desired (e.g., if only the
basic Tcl commands are needed), you can hide this window using a <tt class="docutils literal"><span class="pre">tk</span> <span class="pre">&quot;wm</span>
<span class="pre">withdraw</span> <span class="pre">.&quot;</span></tt> command. To redisplay the window when it is needed, use the
<tt class="docutils literal"><span class="pre">tk</span> <span class="pre">&quot;wm</span> <span class="pre">deiconify</span> <span class="pre">.&quot;</span></tt> command. It is also common practice to use <tt class="docutils literal"><span class="pre">wm</span>
<span class="pre">withdraw</span></tt> and <tt class="docutils literal"><span class="pre">wm</span> <span class="pre">deiconify</span></tt> while creating the widgets of an
application, in order to reduce &quot;flickering&quot;.</p>
</li>
<li><p class="first">Instead of calling <tt class="docutils literal"><span class="pre">tk_main</span></tt>, you can also code your own main loop in Pure
as follows:</p>
<pre class="literal-block">
main = do_something $$ main if tk_ready;
     = () otherwise;
</pre>
<p>Note that the <tt class="docutils literal"><span class="pre">tk_ready</span></tt> function checks whether the Tcl interpreter is
still up and running, after processing any pending events in the
interpreter. This setup allows you to do your own custom idle processing in
Pure while the application is running. However, you have to be careful that
your <tt class="docutils literal"><span class="pre">do_something</span></tt> routine runs neither too short nor too long (a few
milliseconds should usually be ok). Otherwise your main loop may turn into a
busy loop and/or the GUI may become very sluggish and unresponsive. Thus
it's usually better to just call <tt class="docutils literal"><span class="pre">tk_main</span></tt> and do any necessary background
processing using the Tcl interpreter's own facilities (e.g., by setting up a
Pure callback with the Tcl <tt class="docutils literal"><span class="pre">after</span></tt> command).</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">tk</span></tt> function can become rather tedious when coding larger Tk
applications. Usually, you will prefer to put the commands making up your
application into a separate Tcl script, and then invoke this script from
your Pure script using the Tcl <tt class="docutils literal"><span class="pre">source</span></tt> command, e.g.:</p>
<pre class="literal-block">
tk &quot;source myapp.tcl&quot;;
</pre>
<p>This is also the method to use for running existing Tk applications, e.g.,
if you create the interface using some interface builder like <a class="reference external" href="http://vtcl.sourceforge.net">vtcl</a>.</p>
</li>
</ul>
<ul>
<li><p class="first">The Tcl <tt class="docutils literal"><span class="pre">package</span></tt> command allows you to load additional extensions into
the Tcl interpreter at runtime. For instance:</p>
<pre class="literal-block">
tk &quot;package require Gnocl&quot;;
</pre>
<p>This loads Peter G. Baum's <a class="reference external" href="http://www.gnocl.org">Gnocl</a> extension which turns Tcl into a frontend
for <a class="reference external" href="http://www.gtk.org/">GTK+</a> and <a class="reference external" href="http://www.gnome.org/">Gnome</a>.</p>
</li>
</ul>
<ul>
<li><p class="first">The Tcl <tt class="docutils literal"><span class="pre">exit</span></tt> procedure, just as in tclsh or wish, causes exit from the
current process. Since the Tcl interpreter hosted by the pure-tk module runs
as part of a Pure program and not as a separate child process, <tt class="docutils literal"><span class="pre">tk</span> <span class="pre">&quot;exit&quot;</span></tt>
will also exit from the Pure program and take you back to the shell. If
you'd like <tt class="docutils literal"><span class="pre">exit</span></tt> to only exit the Tcl interpreter, without exiting Pure,
you can redefine the <tt class="docutils literal"><span class="pre">exit</span></tt> procedure, e.g., as follows:</p>
<pre class="literal-block">
tk &quot;proc exit { {returnCode 0} } { pure tk_quit }&quot;;
</pre>
<p>If you want to do something with the exit code provided by <tt class="docutils literal"><span class="pre">exit</span></tt>, you
will have to provide an appropriate callback function, e.g.:</p>
<pre class="literal-block">
tk &quot;proc exit { {returnCode 0} } { pure quit_cb $returnCode }&quot;;
</pre>
<p>A suitable implementation of <tt class="docutils literal"><span class="pre">quit_cb</span></tt> might look as follows:</p>
<pre class="literal-block">
quit_cb 0 = puts &quot;Application exited normally.&quot; $$ tk_quit;
quit_cb n = printf &quot;Application exited with exit code %d.\n&quot; n $$
            tk_quit otherwise;
</pre>
</li>
<li><p class="first">If you need dialogs beyond the standard kinds of message boxes and common
dialogs, you will have to do these yourself using a secondary toplevel. The
dialog toplevel is just like the main window but will only be shown when the
application needs it. You can construct both non-modal and modal dialogs
this way, the latter can be implemented using Tk's <tt class="docutils literal"><span class="pre">grab</span></tt> command.</p>
</li>
</ul>
</div>
</div>
</body>
</html>
