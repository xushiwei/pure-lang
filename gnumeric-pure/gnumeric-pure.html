<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
<title>Gnumeric/Pure: A Pure Plugin for Gnumeric</title>
<meta name="author" content="Albert Graef" />
<meta name="copyright" content="Copyright (c) 2009 by Albert Graef. Distributed under the GNU Public License V3, see COPYING for details." />
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 5631 2008-08-24 13:01:23Z goodger $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left {
  clear: left }

img.align-right {
  clear: right }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="gnumeric-pure-a-pure-plugin-for-gnumeric">
<h1 class="title">Gnumeric/Pure: A Pure Plugin for Gnumeric</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Author:</th>
<td>Albert Graef</td></tr>
<tr><th class="docinfo-name">Contact:</th>
<td><a class="first last reference external" href="mailto:Dr.Graef&#64;t-online.de">Dr.Graef&#64;t-online.de</a></td></tr>
<tr><th class="docinfo-name">Copyright:</th>
<td>Copyright (c) 2009 by Albert Graef. Distributed under the GNU
Public License V3, see COPYING for details.</td></tr>
</tbody>
</table>
<p>This package provides a Pure plugin loader and a sample script for use with
<a class="reference external" href="http://projects.gnome.org/gnumeric/">Gnumeric</a>. These work pretty much like the Perl and Python plugin loaders
which are distributed with Gnumeric. <a class="reference external" href="http://pure-lang.googlecode.com/">Pure</a> is a functional programming
language based on the term rewriting calculus with good support for math
operations, so it makes for a nice Gnumeric companion.</p>
<div class="section" id="installation">
<h1>Installation</h1>
<p>Obviously, you need to have both Pure and Gnumeric installed. Unfortunately,
building the plugin is a bit more involved than usual, because typical
Gnumeric installations lack some headers needed to compile Gnumeric plugins.</p>
<p>See the beginning of the Makefile for detailed instructions. Briefly, you'll
have to find the gnumeric-config.h and gnumeric-features.h files from the
Gnumeric sources. Either place these into the directory with the gnumeric-pure
sources, or edit the <tt class="docutils literal"><span class="pre">INCLUDE</span></tt> variable at the beginning of the Makefile so
that gcc finds these headers.</p>
<p>Then run <tt class="docutils literal"><span class="pre">make</span></tt>. You might have to adjust the settings at the beginning of
the Makefile to make this work. If you're lucky and the compile goes through,
you should now have a pure_loader.so file in the pure-loader subdirectory. You
can install the plugin and related stuff with <tt class="docutils literal"><span class="pre">sudo</span> <span class="pre">make</span> <span class="pre">install</span></tt> in the
global Gnumeric plugin directory, or if you prefer to install into the
Gnumeric's user plugin directory then run <tt class="docutils literal"><span class="pre">make</span> <span class="pre">install-local</span></tt> instead.
We recommend the latter since it lets you adjust pure_func.pure for your
purposes more easily. Optionally, you might also want to copy the
gnumeric-pure.html file to your Pure library directory so that you can read it
with the <tt class="docutils literal"><span class="pre">help</span></tt> command of the Pure interpreter or in Emacs Pure mode.</p>
<p>Typically, <tt class="docutils literal"><span class="pre">make</span> <span class="pre">install</span></tt> and <tt class="docutils literal"><span class="pre">make</span> <span class="pre">install-local</span></tt> will install the
plugins into the following directories by default:</p>
<ul class="simple">
<li>System-wide installations go into /usr/local/gnumeric/1.9.x/plugins or
similar, depending on where Gnumeric is installed.</li>
<li>User-specific installations go into ~/.gnumeric/1.9.x/plugins.</li>
</ul>
<p>The Makefile tries to guess the installation path and version number of
Gnumeric on its own. If it guesses wrong, you can change these using the
Makefile variables <tt class="docutils literal"><span class="pre">prefix</span></tt> and <tt class="docutils literal"><span class="pre">gnmversion</span></tt>, respectively. For instance:</p>
<pre class="literal-block">
$ make prefix=/usr gnmversion=1.9.12
</pre>
<p>If <tt class="docutils literal"><span class="pre">make</span> <span class="pre">install</span></tt> doesn't work for some reason, you can also just copy the
pure-func and pure-loader directories manually to your Gnumeric plugin
directory.</p>
</div>
<div class="section" id="basic-usage">
<h1>Basic Usage</h1>
<p>Once Gnumeric/Pure has been properly installed, you should see it in
Gnumeric's <tt class="docutils literal"><span class="pre">Tools</span></tt>/<tt class="docutils literal"><span class="pre">Plug-ins</span></tt> dialog. As with the Perl and Python plugins,
there are actually two entries, one labelled <tt class="docutils literal"><span class="pre">Pure</span> <span class="pre">functions</span></tt> and the other
one labelled <tt class="docutils literal"><span class="pre">Pure</span> <span class="pre">plugin</span> <span class="pre">loader</span></tt>. You need to enable both.</p>
<p>Now you should be ready to join the fun. Click on a cell and invoke the
<tt class="docutils literal"><span class="pre">f(x)</span></tt> dialog. The Pure functions available for use are shown in the
<tt class="docutils literal"><span class="pre">Pure</span></tt> category. E.g., click on <tt class="docutils literal"><span class="pre">pure_hello</span></tt>. Now the Pure interpreter
will be loaded and the function description displayed. Click <tt class="docutils literal"><span class="pre">Insert</span></tt> and
then <tt class="docutils literal"><span class="pre">Ok</span></tt>. You should now be able to read the friendly greeting returned by
the <tt class="docutils literal"><span class="pre">pure_hello</span></tt> function.</p>
<p>Of course, you can also enter the function call directly as a formula into a
cell as usual. Click on a cell, then enter the following:</p>
<pre class="literal-block">
=pure_hello(getenv(&quot;USER&quot;))
</pre>
<p>The greeting should now be displayed with your login name in it.</p>
<p>Play around a bit with the other Pure functions. These functions are nothing
special; they are just ordinary Pure functions which are defined by the
pure_func.pure script in the pure-func subdirectory of your Gnumeric plugin
directory. You can have a look at them by invoking the <tt class="docutils literal"><span class="pre">Edit</span> <span class="pre">Pure</span> <span class="pre">Script</span></tt>
option which gets added to the <tt class="docutils literal"><span class="pre">Tools</span></tt> menu once the Pure plugin loader is
enabled. (This will invoke the emacs editor by default, or the editor named by
the <tt class="docutils literal"><span class="pre">EDITOR</span></tt> environment variable. You can set this environment variable in
your shell's startup files.) The <tt class="docutils literal"><span class="pre">Tools</span></tt> menu contains a second Pure-related
option, <tt class="docutils literal"><span class="pre">Reload</span> <span class="pre">Pure</span> <span class="pre">Scripts</span></tt> which can be used to quickly reload all loaded
Pure scripts after edits; more about that later.</p>
<p>Please note that most of the functions in pure_func.pure are rather useless,
they are only provided for illustrative purposes. However, there are some
useful examples in there, too, in particular:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">pure_eval</span></tt> lets you evaluate any Pure expression, given as a string in
its first argument. E.g., try something like <tt class="docutils literal"><span class="pre">=pure_eval(&quot;foldl</span> <span class="pre">(+)</span> <span class="pre">0</span>
<span class="pre">(1..100)&quot;)</span></tt>. Additional parameters are accessible as <tt class="docutils literal"><span class="pre">x!0</span></tt>, <tt class="docutils literal"><span class="pre">x!1</span></tt>,
etc. For instance: <tt class="docutils literal"><span class="pre">=pure_eval(&quot;x!0+x!1&quot;,A1,B1)</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">pure_echo</span></tt> just displays its arguments as a string in Pure syntax, as the
interpreter sees them. This is useful for debugging purposes. E.g.,
<tt class="docutils literal"><span class="pre">=pure_echo(A1:B10)</span></tt> shows the given range as a Pure matrix.</li>
</ul>
<p>A little example spreadsheet showing the predefined functions in action can be
found in pure-examples.gnumeric in the Gnumeric/Pure sources.</p>
</div>
<div class="section" id="defining-your-own-functions">
<h1>Defining Your Own Functions</h1>
<p>After playing around with pure_func.pure for a while, of course you will want
to write your own functions, that's what this plugin is about after all! For
the beginning, you can just add your definitions to the existing
pure_func.pure script. Use the <tt class="docutils literal"><span class="pre">Edit</span> <span class="pre">Pure</span> <span class="pre">Script</span></tt> option to edit the script
in your favourite editor, and see the comments and the examples in the
script.pure for guidance. (This document assumes that you're already familiar
with Pure, if not then you should consult the available Pure documentation.)</p>
<p>Note that if you delete or rename any functions in this file, or add new ones
then you also have to change the list of function names in the plugin.xml file
in the same directory accordingly. This file tells Gnumeric which functions
are provided by the script. Unfortunately, you'll have to restart Gnumeric to
make changes in this file take effect. If you only change the definition of an
existing function then it's usually sufficient to just invoke <tt class="docutils literal"><span class="pre">Reload</span> <span class="pre">Pure</span>
<span class="pre">Scripts</span></tt> afterwards, and maybe run <tt class="docutils literal"><span class="pre">Recalculate</span></tt> (<tt class="docutils literal"><span class="pre">F9</span></tt>) to recompute the
spreadsheet. However, if you also made changes to the function descriptions
provided via <tt class="docutils literal"><span class="pre">gnm_info</span></tt> (see the following section for explanation), then
you'll also have to restart Gnumeric so that it picks up the changes.</p>
<p>Once you understand how this works, you can also create your own plugin
directories with your personal collections of Gnumeric/Pure functions, using
the pure-func directory as a template. For instance, assume that your
Gnumeric/Pure stuff is in a script named gnumeric.pure in the
$HOME/pure/gnumeric directory, where $HOME is the name of your home
directory. The plugin.xml file in that directory might look as follows:</p>
<pre class="literal-block">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;plugin id=&quot;Gnumeric_MyPureFunc&quot;&gt;
  &lt;information&gt;
    &lt;name&gt;My Pure functions&lt;/name&gt;
    &lt;description&gt;My Pure functions for use in Gnumeric.&lt;/description&gt;
    &lt;require_explicit_enabling/&gt;
  &lt;/information&gt;
  &lt;loader type=&quot;Gnumeric_PureLoader:pure&quot;&gt;
    &lt;attribute value=&quot;gnumeric&quot; name=&quot;module_name&quot;/&gt;
  &lt;/loader&gt;
  &lt;services&gt;
    &lt;service type=&quot;function_group&quot; id=&quot;my_pure_func&quot;&gt;
      &lt;category&gt;Pure&lt;/category&gt;
      &lt;functions&gt;
        &lt;function name=&quot;pure_hello&quot;/&gt;
        &lt;!-- My Pure functions go here... --&gt;
      &lt;/functions&gt;
    &lt;/service&gt;
  &lt;/services&gt;
&lt;/plugin&gt;
</pre>
<p>The following steps are needed to tell Gnumeric about your new Pure plugin:</p>
<ul class="simple">
<li>Open the <tt class="docutils literal"><span class="pre">Directories</span></tt> tab in the <tt class="docutils literal"><span class="pre">Tools</span></tt>/<tt class="docutils literal"><span class="pre">Plug-ins</span></tt> dialog and add
the parent directory ($HOME/pure in this case) to the plugin search
path. You might have to restart Gnumeric after that.</li>
<li>The plugin can now be enabled in the <tt class="docutils literal"><span class="pre">Tools</span></tt>/<tt class="docutils literal"><span class="pre">Plug-ins</span></tt> dialog under
<tt class="docutils literal"><span class="pre">My</span> <span class="pre">Pure</span> <span class="pre">functions</span></tt>.</li>
</ul>
<p>The Pure loader can also load multiple Pure scripts, just enable the ones that
you want in <tt class="docutils literal"><span class="pre">Tools</span></tt>/<tt class="docutils literal"><span class="pre">Plug-ins</span></tt>. All scripts are loaded in the same Pure
interpreter (and thus are treated like one big script) so that they can
communicate with each other if necessary.</p>
</div>
<div class="section" id="gnumeric-values-and-functions-in-pure">
<h1>Gnumeric Values and Functions in Pure</h1>
<p>The marshalling of types between Gnumeric and Pure is pretty straightforward;
basically, Pure numbers, strings and matrices map to Gnumeric numbers, strings
and arrays, respectively. The following table summarizes the available
conversions:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Pure</th>
<th class="head">Gnumeric</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><tt class="docutils literal"><span class="pre">()</span></tt></td>
<td>empty</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">4711</span></tt>, <tt class="docutils literal"><span class="pre">4711L</span></tt>, <tt class="docutils literal"><span class="pre">4711.0</span></tt></td>
<td>scalar (number)</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">&quot;Hello</span> <span class="pre">world&quot;</span></tt></td>
<td>string</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">[1,2,3]</span></tt></td>
<td>array</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">{1,2,3;4,5,6}</span></tt></td>
<td>array (or cell range)</td>
</tr>
</tbody>
</table>
<p>Note that on input, cell ranges are always passed as matrices to Pure
functions (not the cell references themselves). Conversely, both matrices and
lists become Gnumeric arrays on output. The empty tuple can be used to denote
empty Gnumeric values.</p>
<p>The pure_func.pure script contains some code showing how to write functions
which can deal with any numbers of scalars, arrays or ranges, see the
<tt class="docutils literal"><span class="pre">ranges</span></tt> function and the <tt class="docutils literal"><span class="pre">pure_sum</span></tt> and <tt class="docutils literal"><span class="pre">pure_sums</span></tt> examples in the
script for details.</p>
<p>Last but not least, it is also possible to call Gnumeric functions from
Pure. See <tt class="docutils literal"><span class="pre">gnm_bitand</span></tt> in pure_func.pure for an example. More comprehensive
facilities to directly work with Gnumeric spreadsheets may be added in the
future.</p>
</div>
<div class="section" id="customization">
<h1>Customization</h1>
<p>Gnumeric doesn't provide much in the way of GUI customization options right
now, but at least it's possible for plugins to install and configure
additional menu and toolbar options. As already mentioned, the Pure plugin
loader adds two additional options to the <tt class="docutils literal"><span class="pre">Tools</span></tt> menu which allow you to
reload Pure scripts and edit them. The definitions of these items can be found
in the pure-loader/pure-ui.xml file in your Gnumeric plugin directory. Have a
look at this file and edit is as desired, e.g., if you want to put the
Pure-related options into a submenu, add them to another menu, or enable
toolbar buttons for these menu options.</p>
</div>
</div>
</body>
</html>
