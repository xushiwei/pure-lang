<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
<title>pure-fastcgi: FastCGI module for Pure</title>
<meta name="author" content="Albert Graef" />
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 5631 2008-08-24 13:01:23Z goodger $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left {
  clear: left }

img.align-right {
  clear: right }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="pure-fastcgi-fastcgi-module-for-pure">
<h1 class="title">pure-fastcgi: FastCGI module for Pure</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Author:</th>
<td>Albert Graef</td></tr>
<tr><th class="docinfo-name">Contact:</th>
<td><a class="first last reference external" href="mailto:Dr.Graef&#64;t-online.de">Dr.Graef&#64;t-online.de</a></td></tr>
</tbody>
</table>
<p>This module lets you write <a class="reference external" href="http://www.fastcgi.com">FastCGI</a> scripts with Pure, to be run by web
servers like <a class="reference external" href="http://www.apache.org/">Apache</a>. Compared to normal CGI scripts, this has the advantage
that the script keeps running and may process as many requests from the web
server as you like. Most ordinary CGI scripts can be converted to use FastCGI
with some minimal changes.</p>
<div class="section" id="copying">
<h1>Copying</h1>
<p>Copyright (c) 2009 by Albert Graef. pure-fastcgi is distributed under a
3-clause BSD-style license, please see the included COPYING file for details.</p>
</div>
<div class="section" id="installation">
<h1>Installation</h1>
<p>Besides Pure, you'll need to have the <a class="reference external" href="http://www.fastcgi.com">FastCGI</a> library installed to compile
this module. Also, to run FastCGI scripts, your web server must be configured
accordingly; see the documentation of FastCGI and your web server for details.</p>
<p>Running <tt class="docutils literal"><span class="pre">make</span></tt> compiles the module, <tt class="docutils literal"><span class="pre">make</span> <span class="pre">install</span></tt> installs it in your
Pure library directory. You might have to adjust the path to the fcgi_stdio.h
header file in fastcgi.c and/or the option to link in the FastCGI library in
the Makefile.</p>
<p>The Makefile tries to guess the host system type and Pure version, and
set up some platform-specific things accordingly. If this doesn't work for
your system then you'll have to edit the Makefile accordingly.</p>
</div>
<div class="section" id="usage">
<h1>Usage</h1>
<p>pure-fastcgi provides the <tt class="docutils literal"><span class="pre">accept</span></tt> function with which you tell the FastCGI
server that your script is ready to accept another request from the FastCGI
server. It also overrides a number of standard I/O functions so that they talk
to the server instead. These routines are all in the <tt class="docutils literal"><span class="pre">fastcgi</span></tt> namespace. In
your Pure script, you can set up a simple loop to process requests as
follows:</p>
<pre class="literal-block">
#!/usr/local/bin/pure -x

using fastcgi;
using namespace fastcgi;

extern char *getenv(char*);

main count = main count when
  count = count+1;
  printf &quot;Content-type: text/html\n\n\
&lt;title&gt;FastCGI Hello! (Pure, fcgi_stdio library)&lt;/title&gt;\
&lt;h1&gt;FastCGI Hello! (Pure, fcgi_stdio library)&lt;/h1&gt;\
Request number %d running on host &lt;i&gt;%s&lt;/i&gt;\n&quot;
  (count,getenv &quot;SERVER_NAME&quot;);
end if accept &gt;= 0;

main 0;
</pre>
<p>This script keeps running until <tt class="docutils literal"><span class="pre">accept</span></tt> returns <tt class="docutils literal"><span class="pre">-1</span></tt> to indicate that the
script should exit. (Each call to <tt class="docutils literal"><span class="pre">accept</span></tt> blocks until either a request is
available or the FastCGI server detects an error or termination condition.)</p>
<p>A number of other routines are provided to deal with data filters, finish a
request and set an exit status for a request, see fastcgi.pure. These
correspond to the corresponding operations provided by the FastCGI library,
see the FastCGI documentation and the FCGI_Accept(3), FCGI_StartFilterData(3),
FCGI_Finish(3) and FCGI_SetExitStatus(3) manpages for details. Note that in
Pure these functions are named <tt class="docutils literal"><span class="pre">accept</span></tt>, <tt class="docutils literal"><span class="pre">start_filter_data</span></tt>, <tt class="docutils literal"><span class="pre">finish</span></tt>
and <tt class="docutils literal"><span class="pre">set_exit_status</span></tt>, respectively, and are all found in the <tt class="docutils literal"><span class="pre">fastcgi</span></tt>
namespace.</p>
<p>To run your FastCGI scripts in a browser, your web server must have the
FastCGI module loaded and must also be set up to execute the scripts. E.g.,
when using Apache, the following configuration file entry will set up a
directory for FastCGI scripts:</p>
<pre class="literal-block">
ScriptAlias /fastcgi-bin/ &quot;/srv/www/fastcgi-bin/&quot;
&lt;Location /fastcgi-bin/&gt;
    Options ExecCGI
    SetHandler fcgid-script
    Order allow,deny
    Allow from all
&lt;/Location&gt;
</pre>
<p>You'll have to put this into http.conf or a similar file provided by your
Apache installation (usually under /etc/apache2), and restart Apache. After
that you can just throw your scripts into the <tt class="docutils literal"><span class="pre">fastcgi-bin</span></tt> directory to
have them executed when opening an URL like
<tt class="docutils literal"><span class="pre">http://localhost/fastcgi-bin/myscript</span></tt> in the browser. (You might have to
adjust the &quot;shebang&quot; at the beginning of the script above accordingly, so that
the shell finds your Pure interpreter. Also, remember to make the script
executable. If you're worried about startup times, or if your operating system
doesn't support shebangs, then you can also use the Pure interpreter to
compile the script to a native executable instead.)</p>
<p>See the examples subdirectory in the sources for some examples.</p>
</div>
</div>
</body>
</html>
